# å¤šä½ç½®é€‰å–ä¸è½®æµç‚¹å‡»åŠŸèƒ½è¯´æ˜

## åŠŸèƒ½æ¦‚è¿°

æ”¯æŒåœ¨å±å¹•ä¸Šé€‰å–å¤šä¸ªä½ç½®ï¼ˆæœ€å¤š10ä¸ªï¼‰ï¼Œç‚¹å‡»"å¼€å§‹"åä¼š**æŒ‰é¡ºåºè½®æµç‚¹å‡»æ‰€æœ‰é€‰ä¸­çš„ä½ç½®**ã€‚

## ä¸»è¦ç‰¹æ€§

### 1. å¤šä½ç½®é€‰å–
- **æœ€å¤§æ•°é‡**ï¼š10ä¸ªä½ç½®
- **é€‰å–æ–¹å¼**ï¼šè¿›å…¥é€‰å–æ¨¡å¼åï¼Œç‚¹å‡»å±å¹•ä»»æ„ä½ç½®æ·»åŠ æ ‡è®°
- **å–æ¶ˆé€‰å–**ï¼šå†æ¬¡ç‚¹å‡»å·²é€‰ä½ç½®ï¼ˆæ ‡è®°åœ†åœˆï¼‰åˆ™å–æ¶ˆè¯¥ä½ç½®
- **ä½ç½®æ ‡è®°**ï¼šæ¯ä¸ªä½ç½®æ˜¾ç¤ºåºå·ï¼ˆ1-10ï¼‰

### 2. è½®æµç‚¹å‡»
- **ç‚¹å‡»æ¨¡å¼**ï¼šæŒ‰ç…§é€‰å–é¡ºåºï¼ˆâ‘ â†’â‘¡â†’â‘¢...ï¼‰ä¾æ¬¡ç‚¹å‡»å„ä¸ªä½ç½®
- **éšæœºåç§»**ï¼šæ¯ä¸ªä½ç½®ç‹¬ç«‹åº”ç”¨éšæœºåç§»
- **è§†è§‰åé¦ˆ**ï¼šç‚¹å‡»æ—¶å½“å‰ä½ç½®çš„æ ‡è®°å˜é»„è‰²ï¼Œå…¶ä»–ä¿æŒç°è‰²
- **ç‚¹å‡»é—´éš”**ï¼šä½¿ç”¨è®¾å®šçš„éšæœºé—´éš”åç‚¹å‡»ä¸‹ä¸€ä¸ªä½ç½®

## ä½¿ç”¨æµç¨‹

```
1. ç‚¹å‡»"é€‰å–"æŒ‰é’®
   â””â”€> è¿›å…¥é€‰å–æ¨¡å¼

2. åœ¨å±å¹•ä¸Šç‚¹å‡»å¤šä¸ªä½ç½®
   â””â”€> ä½ç½®1: æ˜¾ç¤º â‘  æ ‡è®°
   â””â”€> ä½ç½®2: æ˜¾ç¤º â‘¡ æ ‡è®°
   â””â”€> ä½ç½®3: æ˜¾ç¤º â‘¢ æ ‡è®°
   â””â”€> ...

3. è‹¥è¦å–æ¶ˆæŸä¸ªä½ç½®
   â””â”€> ç‚¹å‡»è¯¥ä½ç½®çš„æ ‡è®°åœ†åœˆ
       â””â”€> æ ‡è®°æ¶ˆå¤±

4. ç‚¹å‡»"å¼€å§‹"æŒ‰é’®
   â””â”€> æŒ‰é¡ºåºè½®æµç‚¹å‡»
       â””â”€> â‘  å˜é»„ï¼ˆç‚¹å‡»ä½ç½®1ï¼‰
       â””â”€> ç­‰å¾…éšæœºé—´éš”ï¼ˆ150-300msï¼‰
       â””â”€> â‘¡ å˜é»„ï¼ˆç‚¹å‡»ä½ç½®2ï¼‰
       â””â”€> ç­‰å¾…éšæœºé—´éš”
       â””â”€> â‘¢ å˜é»„ï¼ˆç‚¹å‡»ä½ç½®3ï¼‰
       â””â”€> ...
       â””â”€> å›åˆ° â‘  ç»§ç»­å¾ªç¯

5. ç‚¹å‡»"æš‚åœ"åœæ­¢ç‚¹å‡»
6. ç‚¹å‡»"æ¸…ç©º"æ¸…é™¤æ‰€æœ‰ä½ç½®
```

## ä»£ç å®ç°

### 1. FloatingBallView.java

#### å¢åŠ ä½ç½®ä¸Šé™
```java
private int maxPositions = 10; // æœ€å¤šå¯ä»¥é€‰å–10ä¸ªä½ç½®
```

#### ç‚¹å‡»çŠ¶æ€è·Ÿè¸ª
```java
private java.util.Set<Integer> clickingPositions = new java.util.HashSet<>();
```

#### é€‰å–é€»è¾‘ä¿®æ”¹
```java
private boolean handleSelectionModeTouch(float x, float y) {
    // æ£€æŸ¥æ˜¯å¦ç‚¹å‡»äº†å·²å­˜åœ¨çš„ä½ç½®ï¼ˆå–æ¶ˆé€‰å–ï¼‰
    for (int i = 0; i < clickPositions.size(); i++) {
        ClickPosition pos = clickPositions.get(i);
        if (isPointInCircle(screenX, screenY, pos.getX(), pos.getY(), 30)) {
            clickPositions.remove(i); // å–æ¶ˆè¿™ä¸ªä½ç½®
            return true;
        }
    }
    
    // æ£€æŸ¥æ˜¯å¦å·²è¾¾åˆ°æœ€å¤§ä½ç½®æ•°
    if (clickPositions.size() >= maxPositions) {
        showToast("æœ€å¤šåªèƒ½é€‰å– " + maxPositions + " ä¸ªä½ç½®");
        return true;
    }
    
    // æ·»åŠ æ–°ä½ç½®
    clickPositions.add(new ClickPosition(screenX, screenY));
    return true;
}
```

#### ç»˜åˆ¶å¤šä¸ªæ ‡è®°
```java
private void drawClickPositions(Canvas canvas) {
    for (int i = 0; i < clickPositions.size(); i++) {
        ClickPosition pos = clickPositions.get(i);
        
        // æ ¹æ®è¿™ä¸ªä½ç½®æ˜¯å¦æ­£åœ¨ç‚¹å‡»æ”¹å˜é¢œè‰²
        if (clickingPositions.contains(i)) {
            circlePaint.setColor(Color.parseColor(COLOR_YELLOW)); // é»„è‰²
        } else {
            circlePaint.setColor(Color.parseColor(COLOR_GRAY)); // ç°è‰²
        }
        canvas.drawCircle(localX, localY, 30, circlePaint);
        
        // ç»˜åˆ¶åºå·
        canvas.drawText(String.valueOf(i + 1), localX, textY, numberPaint);
    }
}
```

#### ç‹¬ç«‹ä½ç½®ç‚¹å‡»çŠ¶æ€
```java
public void setPositionClicking(int index, boolean clicking) {
    if (clicking) {
        clickingPositions.add(index);
    } else {
        clickingPositions.remove(index);
    }
    invalidate();
}
```

### 2. AutoClickService.java

#### æŒ‰é¡ºåºè½®æµç‚¹å‡»
```java
clickRunnable = new Runnable() {
    @Override
    public void run() {
        if (isClicking && !clickPositions.isEmpty()) {
            // è½®æµç‚¹å‡»ï¼šæ¯æ¬¡ç‚¹å‡»å½“å‰ç´¢å¼•çš„ä½ç½®
            ClickPosition pos = clickPositions.get(currentClickIndex);
            
            if (pos.isActive()) {
                // åº”ç”¨éšæœºåç§»
                float[] offsetPos = getRandomOffset(pos.getX(), pos.getY());
                
                // é€šçŸ¥å¼€å§‹ç‚¹å‡»
                notifyClickStart(currentClickIndex);
                
                // æ‰§è¡Œç‚¹å‡»
                performClick(offsetPos[0], offsetPos[1]);
                
                // é€šçŸ¥ç‚¹å‡»ç»“æŸ
                handler.postDelayed(() -> notifyClickEnd(currentClickIndex), 50);
                
                // åˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªä½ç½®
                currentClickIndex = (currentClickIndex + 1) % clickPositions.size();
            }
            
            // ä½¿ç”¨éšæœºé—´éš”åç‚¹å‡»ä¸‹ä¸€ä¸ªä½ç½®
            long nextInterval = getRandomInterval();
            handler.postDelayed(this, nextInterval);
        }
    }
};
```

### 3. FloatingWindowService.java

#### æ¥æ”¶ç‹¬ç«‹ä½ç½®çš„ç‚¹å‡»é€šçŸ¥
```java
private void registerClickReceiver() {
    clickReceiver = new BroadcastReceiver() {
        @Override
        public void onReceive(Context context, Intent intent) {
            if ("CLICK_START".equals(intent.getAction())) {
                int index = intent.getIntExtra("index", -1);
                if (index >= 0) {
                    floatingBallView.setPositionClicking(index, true);
                }
            } else if ("CLICK_END".equals(intent.getAction())) {
                int index = intent.getIntExtra("index", -1);
                if (index >= 0) {
                    floatingBallView.setPositionClicking(index, false);
                }
            }
        }
    };
}
```

## ä½¿ç”¨åœºæ™¯

### åœºæ™¯1ï¼šæ¸¸æˆæŠ€èƒ½è¿æ‹›
```
é€‰å–ä½ç½®ï¼š
  â‘  - æŠ€èƒ½1æŒ‰é’®
  â‘¡ - æŠ€èƒ½2æŒ‰é’®
  â‘¢ - æ”»å‡»æŒ‰é’®

ç‚¹å‡»å¼€å§‹ï¼š
  æŠ€èƒ½1 â†’ ç­‰å¾…é—´éš” â†’ æŠ€èƒ½2 â†’ ç­‰å¾…é—´éš” â†’ æ”»å‡» â†’ å¾ªç¯
  â†’ å®ç°è‡ªåŠ¨è¿æ‹›å¾ªç¯
```

### åœºæ™¯2ï¼šåº”ç”¨æ‰¹é‡æ“ä½œ
```
é€‰å–ä½ç½®ï¼š
  â‘  - ç‚¹èµæŒ‰é’®
  â‘¡ - æ”¶è—æŒ‰é’®
  â‘¢ - åˆ†äº«æŒ‰é’®

ç‚¹å‡»å¼€å§‹ï¼š
  ç‚¹èµ â†’ æ”¶è— â†’ åˆ†äº« â†’ ç‚¹èµ â†’ ...
  â†’ å¾ªç¯æ‰§è¡Œå„ä¸ªæ“ä½œ
```

### åœºæ™¯3ï¼šå¤šçª—å£è½®è¯¢åˆ·æ–°
```
é€‰å–ä½ç½®ï¼š
  â‘  - çª—å£1çš„åˆ·æ–°æŒ‰é’®
  â‘¡ - çª—å£2çš„åˆ·æ–°æŒ‰é’®
  â‘¢ - çª—å£3çš„åˆ·æ–°æŒ‰é’®

ç‚¹å‡»å¼€å§‹ï¼š
  çª—å£1åˆ·æ–° â†’ çª—å£2åˆ·æ–° â†’ çª—å£3åˆ·æ–° â†’ çª—å£1åˆ·æ–° â†’ ...
  â†’ ä¾æ¬¡è½®è¯¢åˆ·æ–°å„ä¸ªçª—å£
```

## è§†è§‰æ•ˆæœ

### æ ‡è®°æ˜¾ç¤º

```
æœªç‚¹å‡»çŠ¶æ€ï¼š
  â‘   â‘¡  â‘¢  â‘£  â‘¤
  ç°è‰²åœ†åœˆï¼Œé»‘è‰²åºå·

è½®æµç‚¹å‡»çŠ¶æ€ï¼ˆç¤ºä¾‹ï¼šæ­£åœ¨ç‚¹å‡»ä½ç½®2ï¼‰ï¼š
  â‘   â‘¡  â‘¢  â‘£  â‘¤
  ç°  é»„  ç°  ç°  ç°
  
ä¸‹ä¸€è½®ï¼ˆæ­£åœ¨ç‚¹å‡»ä½ç½®3ï¼‰ï¼š
  â‘   â‘¡  â‘¢  â‘£  â‘¤
  ç°  ç°  é»„  ç°  ç°
```

### é€‰å–ä¸å–æ¶ˆ

```
é€‰å–æ¨¡å¼ï¼š
  ç‚¹å‡»ç©ºç™½å¤„ â†’ æ·»åŠ æ ‡è®°
  ç‚¹å‡»å·²æœ‰æ ‡è®° â†’ å–æ¶ˆæ ‡è®°

ä¾‹å¦‚ï¼š
  â‘   â‘¡  â‘¢
  ç‚¹å‡» â‘¡ â†’ å˜æˆ â‘   â‘¢ï¼ˆåºå·è‡ªåŠ¨è°ƒæ•´ï¼‰
```

## æ—¥å¿—è¾“å‡º

### é€‰å–ä½ç½®
```
Selection touch: local(500,800) screen(500,800)
Added position 0 at (500.0,800.0)
Added position 1 at (600.0,900.0)
Added position 2 at (700.0,1000.0)
```

### å–æ¶ˆä½ç½®
```
Removed position 1 at (600.0,900.0)
```

### è½®æµç‚¹å‡»
```
Clicking position 0: original(500.0, 800.0) -> offset(503.2, 797.5)
Next click in 234 ms (will click position 1)
Clicking position 1: original(600.0, 900.0) -> offset(595.8, 903.1)
Next click in 187 ms (will click position 2)
Clicking position 2: original(700.0, 1000.0) -> offset(708.9, 1001.4)
Next click in 265 ms (will click position 0)
```

## ä¸å•ä½ç½®æ¨¡å¼çš„å¯¹æ¯”

| ç‰¹æ€§ | å•ä½ç½®æ¨¡å¼ï¼ˆæ—§ï¼‰ | å¤šä½ç½®æ¨¡å¼ï¼ˆæ–°ï¼‰ |
|------|----------------|----------------|
| ä½ç½®æ•°é‡ | 1ä¸ª | æœ€å¤š10ä¸ª |
| é€‰å–æ–¹å¼ | ç‚¹å‡»ä»»æ„ä½ç½® | å¤šæ¬¡ç‚¹å‡»æ·»åŠ  |
| å–æ¶ˆé€‰å– | æ¸…ç©ºæŒ‰é’® | ç‚¹å‡»æ ‡è®°å–æ¶ˆ |
| ç‚¹å‡»æ–¹å¼ | å•ç‚¹é‡å¤ç‚¹å‡» | **è½®æµç‚¹å‡»** |
| è§†è§‰åé¦ˆ | å•ä¸ªåœ†åœˆå˜è‰² | **å½“å‰ä½ç½®åœ†åœˆå˜è‰²** |
| éšæœºåç§» | åº”ç”¨ | æ¯ä¸ªä½ç½®ç‹¬ç«‹åº”ç”¨ |

## æŠ€æœ¯ç»†èŠ‚

### è½®æµç‚¹å‡»çš„å®ç°

ä½¿ç”¨ç´¢å¼• `currentClickIndex` è·Ÿè¸ªå½“å‰è¦ç‚¹å‡»çš„ä½ç½®ï¼š

```java
// ç‚¹å‡»å½“å‰ä½ç½®
ClickPosition pos = clickPositions.get(currentClickIndex);
performClick(pos.getX(), pos.getY());

// åˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªä½ç½®
currentClickIndex = (currentClickIndex + 1) % clickPositions.size();

// ä½¿ç”¨éšæœºé—´éš”åç‚¹å‡»ä¸‹ä¸€ä¸ªä½ç½®
long nextInterval = getRandomInterval();
handler.postDelayed(clickRunnable, nextInterval);
```

**å…³é”®ç‚¹**ï¼š
- æ¯æ¬¡åªç‚¹å‡»ä¸€ä¸ªä½ç½®
- ä½¿ç”¨æ¨¡è¿ç®— `%` å®ç°å¾ªç¯ï¼š0â†’1â†’2â†’...â†’nâ†’0
- æ¯æ¬¡ç‚¹å‡»åç­‰å¾…éšæœºé—´éš”å†ç‚¹å‡»ä¸‹ä¸€ä¸ªä½ç½®

### ç‹¬ç«‹çš„éšæœºåç§»

æ¯ä¸ªä½ç½®ç‹¬ç«‹è®¡ç®—éšæœºåç§»ï¼š

```java
// ä½ç½®1: (100, 200) â†’ åç§» (+3, -2) â†’ å®é™…ç‚¹å‡» (103, 198)
// ä½ç½®2: (200, 300) â†’ åç§» (-5, +7) â†’ å®é™…ç‚¹å‡» (195, 307)
// ä½ç½®3: (300, 400) â†’ åç§» (+2, +1) â†’ å®é™…ç‚¹å‡» (302, 401)
```

### ç‹¬ç«‹çš„è§†è§‰åé¦ˆ

ä½¿ç”¨ `Set<Integer>` è·Ÿè¸ªå½“å‰æ­£åœ¨ç‚¹å‡»çš„ä½ç½®ï¼š

```java
// ç‚¹å‡»ä½ç½®0æ—¶
clickingPositions.add(0); // ä½ç½®0å˜é»„
// 50mså
clickingPositions.remove(0); // ä½ç½®0æ¢å¤ç°è‰²

// ç‚¹å‡»ä½ç½®1æ—¶
clickingPositions.add(1); // ä½ç½®1å˜é»„
// 50mså
clickingPositions.remove(1); // ä½ç½®1æ¢å¤ç°è‰²

// æ¯æ¬¡åªæœ‰ä¸€ä¸ªä½ç½®å˜é»„ï¼Œå…¶ä»–ä¿æŒç°è‰²
```

## æ€§èƒ½è€ƒè™‘

### 1. ç‚¹å‡»æ€§èƒ½

- **å•æ¬¡ç‚¹å‡»æ—¶é—´**ï¼š~5ms
- **ç‚¹å‡»é—´éš”**ï¼š150-300msï¼ˆå¯è®¾ç½®ï¼‰
- **æ€»ä½“å½±å“**ï¼šæµç•…ï¼Œæ— å»¶è¿Ÿ

### 2. ç»˜åˆ¶æ€§èƒ½

- **ç»˜åˆ¶10ä¸ªåœ†åœˆ**ï¼š< 1ms
- **é‡ç»˜é¢‘ç‡**ï¼šç‚¹å‡»æ—¶çº¦ 20fpsï¼ˆ50ms é»„è‰²é—ªçƒï¼‰
- **æ€»ä½“å½±å“**ï¼šæµç•…

### 3. å¹¿æ’­æ€§èƒ½

- **æ¯æ¬¡ç‚¹å‡»å‘é€2ä¸ªå¹¿æ’­**ï¼ˆå¼€å§‹/ç»“æŸï¼‰ï¼š~2ms
- **æ¥æ”¶å¹¶æ›´æ–°UI**ï¼š~1ms
- **æ€»ä½“å½±å“**ï¼šå¯å¿½ç•¥

## é™åˆ¶ä¸å»ºè®®

### ä½ç½®æ•°é‡é™åˆ¶

**æœ€å¤§10ä¸ªä½ç½®**çš„åŸå› ï¼š
1. è¿‡å¤šä½ç½®ä¼šå½±å“ç‚¹å‡»é€Ÿåº¦
2. å±å¹•ç©ºé—´æœ‰é™ï¼Œæ ‡è®°ä¼šé‡å 
3. å®é™…ä½¿ç”¨ä¸­å¾ˆå°‘éœ€è¦è¶…è¿‡10ä¸ªä½ç½®

### æ¨èä½¿ç”¨

| ä½ç½®æ•°é‡ | é€‚ç”¨åœºæ™¯ | ç‚¹å‡»é—´éš”å»ºè®® |
|---------|---------|------------|
| 1-3ä¸ª | æ™®é€šæ¸¸æˆè¿æ‹› | 150-300ms |
| 4-6ä¸ª | å¤æ‚æŠ€èƒ½å¾ªç¯ | 200-400ms |
| 7-10ä¸ª | å¤šæ­¥éª¤è‡ªåŠ¨åŒ– | 300-500ms |

### æ³¨æ„äº‹é¡¹

1. **ä½ç½®é—´è·**ï¼šå»ºè®®æ ‡è®°ä¹‹é—´è‡³å°‘ç›¸è· 100pxï¼Œé¿å…è¯¯è§¦
2. **ç‚¹å‡»é¡ºåº**ï¼šä½ç½®ä¼šæŒ‰ç…§é€‰å–é¡ºåºï¼ˆâ‘ â†’â‘¡â†’â‘¢...ï¼‰ä¾æ¬¡ç‚¹å‡»
3. **å¾ªç¯æ‰§è¡Œ**ï¼šç‚¹å‡»å®Œæœ€åä¸€ä¸ªä½ç½®åä¼šå›åˆ°ç¬¬ä¸€ä¸ªä½ç½®ç»§ç»­
4. **æƒé™è¦æ±‚**ï¼šéœ€è¦æ— éšœç¢æœåŠ¡æƒé™æ‰èƒ½æ¨¡æ‹Ÿç‚¹å‡»

## æµ‹è¯•å»ºè®®

### åŸºç¡€åŠŸèƒ½æµ‹è¯•

1. **é€‰å–æµ‹è¯•**
   - é€‰å–1ä¸ªä½ç½® âœ“
   - é€‰å–10ä¸ªä½ç½® âœ“
   - å°è¯•é€‰å–ç¬¬11ä¸ªä½ç½®ï¼ˆåº”æç¤º"æœ€å¤š10ä¸ª"ï¼‰âœ“

2. **å–æ¶ˆæµ‹è¯•**
   - ç‚¹å‡»æ ‡è®°å–æ¶ˆä½ç½® âœ“
   - å–æ¶ˆååºå·è‡ªåŠ¨è°ƒæ•´ âœ“

3. **ç‚¹å‡»æµ‹è¯•**
   - 1ä¸ªä½ç½®ç‚¹å‡» âœ“
   - 10ä¸ªä½ç½®è½®æµç‚¹å‡» âœ“
   - å½“å‰ä½ç½®æ ‡è®°å˜é»„ï¼Œå…¶ä»–ä¿æŒç°è‰² âœ“
   - ç‚¹å‡»å®Œæœ€åä¸€ä¸ªä½ç½®åå›åˆ°ç¬¬ä¸€ä¸ª âœ“

### æ€§èƒ½æµ‹è¯•

```bash
# æŸ¥çœ‹ç‚¹å‡»æ—¥å¿—
adb logcat | grep "AutoClickService"

# é¢„æœŸè¾“å‡º
Clicking position 0: ...
Next click in 234 ms (will click position 1)
Clicking position 1: ...
Next click in 187 ms (will click position 2)
Clicking position 2: ...
Next click in 265 ms (will click position 3)
...
```

## æ€»ç»“

å¤šä½ç½®é€‰å–ä¸è½®æµç‚¹å‡»åŠŸèƒ½è®©è‡ªåŠ¨è¿å‡»å·¥å…·æ›´åŠ å¼ºå¤§å’Œçµæ´»ï¼š

âœ… æ”¯æŒæœ€å¤š10ä¸ªä½ç½®
âœ… ç‚¹å‡»å·²é€‰ä½ç½®å³å¯å–æ¶ˆ
âœ… æŒ‰é¡ºåºè½®æµç‚¹å‡»å„ä¸ªä½ç½®
âœ… æ¯ä¸ªä½ç½®ç‹¬ç«‹éšæœºåç§»
âœ… ç‹¬ç«‹çš„è§†è§‰åé¦ˆï¼ˆå½“å‰ä½ç½®å˜é»„ï¼‰
âœ… å¾ªç¯æ‰§è¡Œï¼Œè‡ªåŠ¨å›åˆ°ç¬¬ä¸€ä¸ªä½ç½®
âœ… æµç•…çš„æ€§èƒ½è¡¨ç°

ç°åœ¨ä½ å¯ä»¥è½»æ¾å®ç°å¤æ‚çš„æŠ€èƒ½è¿æ‹›å’Œè‡ªåŠ¨åŒ–æ“ä½œï¼ğŸ‰

